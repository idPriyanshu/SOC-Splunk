# Detection Use Case: Brute Force Followed by Privileged Login

## Scenario Description

This scenario simulates a brute force attack with multiple failed login attempts followed by a successful login using admin credentials â€” all originating from the same source IP within a 5-minute window.

## Objective

To detect when a brute-force attack (10+ failed logins) is followed by a successful login from the same source within a short time frame, indicating possible account compromise.

## Tools Used

- **SIEM:** Splunk
- **Log Source:** Windows Event Logs (Security)
- **Log Forwarder:** Winlogbeat
- **Lab Setup:** Shared Resource:
    - A network share was configured:
    - Share Name: NetworkShare
    - Access Credentials:
    - Username: admin
    - Password: [hidden for security]
    - Purpose: Simulate brute force attacks and observe access behaviors

## Event ID / Data Source Mapping

| Source             | Event ID | Description                 |
|--------------------|----------|-----------------------------|
| Windows Security   | 4625     | Failed login attempt        |
| Windows Security   | 4624     | Successful login            |

## Detection Logic / Query (Splunk SPL)
- Brute Force Detection Search 
```spl
EventCode=4625
| transaction Source_Network_Address maxspan=5m
| where eventcount > 4
| stats count by Source_Network_Address
```
- Brute Force Followed by Success Login Detection Search
```spl
(EventCode=4625 OR EventCode=4624)
| transaction Source_Network_Address maxspan=5m
| where eventcount > 4 AND mvcount(EventCode)=2
| stats count by Source_Network_Address
```

## ðŸ“¸ Sample Alert Screenshots
- **Brute Force Alert**
  
![image](https://github.com/user-attachments/assets/277a33ad-9fa9-4568-82f5-01867ca42f14)

- **Brute Force Followed by Success Login Alert**
  
![image](https://github.com/user-attachments/assets/06b04371-a113-4028-985d-2be133b937c9)

## Triggered Alert Details
- **Brute Force Alert**
```text
| Field                    | Value                                                                 |
|--------------------------|-----------------------------------------------------------------------|
| **Timestamp**            | 2025-05-17T22:23:40.902+05:30                                         |
| **Alert Name**           | Brute Force Login Attempt Detection by an IP                          |
| **Search Query**         | `search`                                                              |
| **Host/User**            | PRIYANSHU                                                             |
| **Priority/Count**       | 1                                                                     |
| **Event ID**             | 20286.049                                                             |
| **Saved Search Name**    | rt_scheduler__splunk__search__RMD5d3432ce4246f36a5_at_1747480532_4.2  |
| **Status**               | success                                                               |
| **Generated By**         | Splunk                                                                |
```
- **Brute Force Followed by Success Login Alert**
```text
| Field                    | Value                                                               |
|--------------------------|-----------------------------------------------------------------------|
| **Timestamp**            | 2025-05-17T22:23:55.009+05:30                                         |
| **Alert Name**           | Successful Login detected after Brute forcing within 5 mins           |
| **Search Query**         | `search`                                                              |
| **Host/User**            | PRIYANSHU                                                             |
| **Priority/Count**       | 1                                                                     |
| **Event ID**             | 20335.406                                                             |
| **Saved Search Name**    | rt_scheduler__splunk__search__RMD549fdb673ea14c702_at_1747480496_3.0  |
| **Status**               | success                                                               |
| **Generated By**         | Splunk                                                                |
```
## Sample Events
- **(Failed Login â€“ Event ID 4625)**

This is a real-world example of a failed login attempt captured during brute force simulation:

```text
05/17/2025 10:23:43 PM
LogName=Security
EventCode=4625
EventType=0
ComputerName=Priyanshu
SourceName=Microsoft Windows security auditing.
Type=Information
RecordNumber=3340690
Keywords=Audit Failure
TaskCategory=Logon
OpCode=Info
Message=An account failed to log on.

Subject:
    Security ID:        S-1-0-0
    Account Name:       -
    Account Domain:     -
    Logon ID:           0x0

Logon Type:             3

Account For Which Logon Failed:
    Security ID:        S-1-0-0
    Account Name:       admin
    Account Domain:     -

Failure Information:
    Failure Reason:     Unknown user name or bad password.
    Status:             0xC000006D
    Sub Status:         0xC000006A

Process Information:
    Caller Process ID:  0x0
    Caller Process Name:    -

Network Information:
    Workstation Name:   PRIYANSHU
    Source Network Address: 192.168.166.14
    Source Port:        59509

Detailed Authentication Information:
    Logon Process:      NtLmSsp 
    Authentication Package: NTLM
    Transited Services: -
    Package Name (NTLM only): -
    Key Length:         0

Note:
This event is generated when a logon request fails. It is generated on the computer where access was attempted.
```
- **(Successful Login â€“ Event ID 4624)**

This is an example of a successful login captured after the brute force attempt:

```text
05/17/2025 10:39:15 PM
LogName=Security
EventCode=4624
EventType=0
ComputerName=Priyanshu
SourceName=Microsoft Windows security auditing.
Type=Information
RecordNumber=3342063
Keywords=Audit Success
TaskCategory=Logon
OpCode=Info
Message=An account was successfully logged on.

Subject:
    Security ID:        S-1-5-18
    Account Name:       PRIYANSHU$
    Account Domain:     WORKGROUP
    Logon ID:           0x3E7

Logon Information:
    Logon Type:         5
    Restricted Admin Mode: -
    Remote Credential Guard: -
    Virtual Account:    No
    Elevated Token:     Yes

Impersonation Level:    Impersonation

New Logon:
    Security ID:        S-1-5-18
    Account Name:       SYSTEM
    Account Domain:     NT AUTHORITY
    Logon ID:           0x3E7
    Linked Logon ID:    0x0
    Network Account Name: -
    Network Account Domain: -
    Logon GUID:         {00000000-0000-0000-0000-000000000000}

Process Information:
    Process ID:         0x3e0
    Process Name:       C:\Windows\System32\services.exe

Network Information:
    Workstation Name:   -
    Source Network Address: -
    Source Port:        -

Detailed Authentication Information:
    Logon Process:      Advapi  
    Authentication Package: Negotiate
    Transited Services: -
    Package Name (NTLM only): -
    Key Length:         0

Note:
This event is generated when a logon session is created. It is logged on the computer that was accessed.
```

## Analyst Notes / Recommendations
- When this alert triggers, investigate the source IP and user account used.

- Cross-reference with asset logs to see if the account accessed sensitive systems.

- Possible false positives: Authorized users typing passwords incorrectly before succeeding.

##  Detection Status
- **Successfully Triggered:** Enabled in Splunk, tested using simulated brute force and login success from the same IP within 5 minutes.

