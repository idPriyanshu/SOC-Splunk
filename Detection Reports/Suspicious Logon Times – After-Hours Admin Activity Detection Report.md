# Detection Use Case: Suspicious Logon Times â€“ After-Hours Admin Activity

## Scenario Description

This scenario involves detecting anomalous logon activity during **non-business hours** by privileged accounts, which may indicate unauthorized or malicious access.

> In this case, an admin-level account logs in at **2:30 AM**, accesses key folders/services, and then logs out. Such behavior outside standard working hours could signal credential misuse or lateral movement by an attacker.


## Objective

To detect privileged user logins **outside standard business hours (9 AM - 7 PM)** to identify potential misuse or suspicious activity.


## Tools Used

- **SIEM:** Splunk Enterprise
- **Log Source:** Windows Security Event Logs
- **Log Forwarder:** Winlogbeat
- **Lab Setup:** Shared Resource Usage for Off-Hours Login Detection
      - A network share was configured to observe access behavior during non-business hours.
      - **Share Name:** NetworkShare  
      - **Access Credentials:**
      - **Username:** admin  
      - **Password:** [hidden for security]
      - **Usage Purpose:** Simulate legitimate user accessing the shared resource during off-hours (e.g., 01:00â€“04:00 AM) to evaluate detection of anomalous login patterns.


## Event ID / Data Source Mapping

| Source           | Event ID | Description              |
|------------------|----------|--------------------------|
| Windows Security | 4624     | Successful Logon Event   |



## Detection Logic / Splunk SPL Query

```spl
EventCode=4624
| eval hour=strftime(_time, "%H")
| search (hour < 9 OR hour > 19)
| search Account_Name IN ("Administrator", "Admin", "Domain Admins", "Backup Operators", "SYSTEM")
| stats count by _time, Account_Name, EventCode, Logon_Type
```

### Explanation:
- Filters successful login events.
- Converts timestamps to 24-hour format.
- Flags logins occurring before 9 AM or after 7 PM.
- Focuses on accounts with elevated privileges.



## Sample Alert Screenshots

* **Suspicious Logon Times - After-Hours Admin Activity Alert**

![image](https://github.com/user-attachments/assets/998e1cea-b006-453c-8bcb-3a894f12a085)



## Triggered Alert Details
- **Suspicious Logon Times - After-Hours Admin Activity Alert**

```text
| Field              | Value                               |
|--------------------|-------------------------------------|
| **Timestamp**      | 2025-05-17 02:32:00 AM IST          |
| **Alert Name**     | Suspicious After-Hours Admin Login  |
| **Host/User**      | PRIYANSHU                           |
| **Account Name**   | Administrator                       |
| **Event Code**     | 4624                                |
| **Status**         | Success                             |
| **Generated By**   | Splunk                              |
```



## ðŸ§¾ Sample Event (Successful Login - Event ID 4624)

```text
05/17/2025 02:32:48 AM
LogName=Security
EventCode=4624
EventType=0
ComputerName=Priyanshu
SourceName=Microsoft Windows security auditing.
Type=Information
RecordNumber=3345985
Keywords=Audit Success
TaskCategory=Logon
OpCode=Info
Message=An account was successfully logged on.

Subject:
	Security ID:		S-1-5-18
	Account Name:		PRIYANSHU$
	Account Domain:		WORKGROUP
	Logon ID:		0x3E7

Logon Information:
	Logon Type:		5
	Restricted Admin Mode:	-
	Remote Credential Guard:	-
	Virtual Account:		No
	Elevated Token:		Yes

Impersonation Level:		Impersonation

New Logon:
	Security ID:		S-1-5-18
	Account Name:		SYSTEM
	Account Domain:		NT AUTHORITY
	Logon ID:		0x3E7
	Linked Logon ID:		0x0
	Network Account Name:	-
	Network Account Domain:	-
	Logon GUID:		{00000000-0000-0000-0000-000000000000}

Process Information:
	Process ID:		0x3e0
	Process Name:		C:\Windows\System32\services.exe

Network Information:
	Workstation Name:	-
	Source Network Address:	-
	Source Port:		-

Detailed Authentication Information:
	Logon Process:		Advapi  
	Authentication Package:	Negotiate
	Transited Services:	-
	Package Name (NTLM only):	-
	Key Length:		0

This event is generated when a logon session is created. It is generated on the computer that was accessed.
```

## ðŸ§  Analyst Notes / Recommendations
- Investigate the source host and user involved in the suspicious login activity.  
- Check if the accessed resources or privilege use aligns with the user's role or expected behavior.
- **Possible False Positive:**  Scheduled administrative tasks or legitimate access during off-hours by authorized personnel.


##  Detection Status
- **Successfully Triggered:**: Enabled in Splunk, tested using simulated off-hours login from a priviledged host.
